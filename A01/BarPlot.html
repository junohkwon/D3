<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Scatterplot</title>
  <style>
    .leftChart {
        float: left;
      }
    .rightChart {
        margin-left: 10px;
      }
  </style>
</head>
<body>
  <div>
      <div class="leftChart" id="plot"></div>
  </div>
  <div>
      <div class="rightChart" id="bplot"></div>
  </div>

  <script src="./lib/d3.v5.min.js"></script>
  <script src="./data/movie.js"></script>  
  <script>

    data.forEach(function (d){
        d.us_gross = parseFloat(d.us_gross);
        d.rotten_rating = parseFloat(d.rotten_rating);
    })
    
    //g tag의 위치를 transfer하는 함수
    function translate(x,y) {
      return 'translate('+ x + ',' + y +')';
    }

    let svgWidth = 550;
    let svgHeight = 550;    
    let margin = {top:20, right:10, bottom:30, left:40};
    let maxHeight = 200;
    let maxScore = 3000;
    let maxWidth = 30;

    //margin을 감안하여 chart의 width, height를 계산
    let width = svgWidth - margin.left - margin.right;
    let height = svgHeight - margin.bottom - margin.top;
    
    //svg를 div tag에 코드로 추가함
    let svg = 
    d3.select('#plot')
      .append('svg')
        .attr('width',svgWidth)
        .attr('height',svgHeight)
        .append('g')
          .attr('transform', translate(margin.left, margin.top)); //g tag를 margin만큼 transfer
    
    //Scale 계산
    let x = d3.scaleBand()
              .domain([
                d3.min(data, d => d.rotten_rating),
                d3.max(data, d => d.rotten_rating)
              ]) //최대 최소값의 배열을 넣음
              .range([0, width]); //최대 최소값의 배열을 넣음

    let y = d3.scaleBand()
              .domain([
                d3.min(data, d => d.us_gross),
                d3.max(data, d => d.us_gross)
              ]) //최대 최소값의 배열을 넣음
              .range([height,0]); //최대 최소값의 배열을 넣음 / (0,0)이 좌상단 이므로 scale을 반대로 

    //Point Draw
    svg.selectAll('rect')
        .data(data)
        .enter()
          .append('rect')
          .attr('width', 30) //y 좌표 계산
          .attr('height', d => (d.us_gross / maxScore) * maxHeight) //y 좌표 계산
          .attr('x', (d,i) => i * (maxWidth + 30)) //x 좌표 계산
          .attr('y', function(d,i,nodes){
              return maxHeight - d3.select(this).attr('height');
              }) //y 좌표 계산

    //Axis function 선언
    let xAxis = d3.axisBottom(x);
    let yAxis = d3.axisLeft(y);

    //X-Axis Draw
    svg
    .append('g')  //axis는 g tag로 그린다
      .attr('transform',translate(0,height)) //xAxis의 위치이동
      .call(xAxis);   //xAxis 함수에 attr에서 선언한 정보를 넘겨주는 명령

    //Y-Axis Draw
    svg
    .append('g')
      .attr('transform',translate(0,0)) //yAxis의 위치이동
      .call(yAxis);
  
  </script>
</body>
</html>